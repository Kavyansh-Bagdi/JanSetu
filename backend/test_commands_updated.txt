Test commands and notes â€” Employee + Builder routes (development)

Purpose / behavior (current dev setup)
- Employee endpoints (dev-mode): managers can create roads. When creating a road,
  managers provide either an inspector (inspector_assigned by Employee.unique_id) or
  a manager identifier (manager_unique_id) to satisfy the non-null `employee_id` column.
  Managers cannot set `chief_engineer` or `status` (those are controlled by builders).
- Inspector endpoint: inspectors can list roads assigned to them.
- Builder endpoints: builders can view roads they own/maintain and can assign
  `chief_engineer` and change `status`. In development these builder actions use a
  `builder_unique_id` field in the request body (replace with proper auth in production).

Quick prerequisites (from `backend` folder):
- Activate venv: source .venv/bin/activate
- Install deps if needed: pip install -r requirements.txt
- Make sure DB is created (alembic upgrade head) or use Base.metadata.create_all

0) Seed the DB with sample builder / users / employees (idempotent)
python -m scripts.dev_seed

1) Start the server (run this in Terminal A from the backend folder):
source .venv/bin/activate   # if you use the virtualenv
uvicorn main:app --reload --host 0.0.0.0 --port 8000

2) Create a Road (POST /employee/roads)  -- manager creates a road (dev-mode)
Important: `chief_engineer` and `status` are NOT accepted from this route anymore.
Provide either `inspector_assigned` (employee.unique_id) or `manager_unique_id` (dev-only)
to set Road.employee_id. Coordinates are defaulted to {} in the route for dev.

Example: create by manager (use the unique ids printed by the seeder)
curl -s -X POST "http://127.0.0.1:8000/employee/roads" \
  -H "Content-Type: application/json" \
  -d '{
    "builder_id": 1,
    "cost": 10000.50,
    "started_date": "2025-11-01",
    "manager_unique_id": 1
  }' | jq

Example: create by manager assigning an inspector instead
curl -s -X POST "http://127.0.0.1:8000/employee/roads" \
  -H "Content-Type: application/json" \
  -d '{
    "builder_id": 1,
    "cost": 12000.00,
    "started_date": "2025-11-02",
    "inspector_assigned": 2
  }' | jq

3) Inspector: list roads assigned to an inspector
(GET /employee/inspector/roads?inspector_unique_id=<unique_id>)
curl -s "http://127.0.0.1:8000/employee/inspector/roads?inspector_unique_id=2" | jq

4) Builder: list roads for a builder (owner or maintainer)
(GET /builder/{builder_id}/roads)
curl -s "http://127.0.0.1:8000/builder/1/roads" | jq

5) Builder: assign chief_engineer and/or change status (PATCH)
Dev-mode: include builder_unique_id in the payload to identify the acting builder.
In production, replace this with the authenticated builder identity.
curl -s -X PATCH "http://127.0.0.1:8000/builder/roads/1" \
  -H "Content-Type: application/json" \
  -d '{ "builder_unique_id": 1, "chief_engineer": "Alice Sharma", "status": "completed" }' | jq

6) Helpful troubleshooting and checks
- Show HTTP status + body (don't pipe to jq) to inspect non-JSON errors:
  curl -i -X POST "http://127.0.0.1:8000/employee/roads" -H "Content-Type: application/json" -d '{ "builder_id":1, "cost":10000.5, "started_date":"2025-11-01", "manager_unique_id":1 }'
- If you see sqlite NOT NULL errors for `chief_engineer`: run an Alembic migration
  or manually ALTER the `road` table to allow NULLs for `chief_engineer`. The
  current code sets `chief_engineer` to an empty string on create as a dev workaround.
- Use the interactive docs at http://127.0.0.1:8000/docs to explore request/response shapes.

7) Automated smoke-test (optional)
If you prefer an automated script, create and run `scripts/smoke_test_routes.py` which
will POST a road, GET inspector/builder lists and PATCH the road. Requires `requests`.
